{
    "summary": "Execute Protocol Flow",
    "description": "Execute a protocol step with QA checks.",
  "value": {
    "modules": [
      {
        "id": "tgz_emit_refs",
        "value": {
          "type": "script",
          "path": "u/devgodzilla/emit_tasksgodzilla_codex_refs"
        },
        "input_transforms": {
          "run_id": {
            "type": "javascript",
            "expr": "flow_input.tgz_run_id || null"
          },
          "job_type": {
            "type": "static",
            "value": "windmill_execute_protocol"
          },
          "run_kind": {
            "type": "static",
            "value": "exec"
          },
          "project_id": {
            "type": "javascript",
            "expr": "flow_input.project_id || null"
          },
          "protocol_run_id": {
            "type": "javascript",
            "expr": "flow_input.protocol_run_id || null"
          },
          "step_run_id": {
            "type": "javascript",
            "expr": "flow_input.step_run_id || null"
          },
          "params": {
            "type": "javascript",
            "expr": "flow_input.tgz_params || null"
          },
          "attach_default_artifacts": {
            "type": "javascript",
            "expr": "flow_input.tgz_attach_default_artifacts !== false"
          }
        }
      },
      {
        "id": "execute_step",
        "value": {
          "type": "script",
          "path": "u/devgodzilla/execute_step"
        },
        "input_transforms": {
          "step_id": {
            "type": "javascript",
            "expr": "flow_input.step_id"
          },
          "agent_id": {
            "type": "javascript",
            "expr": "flow_input.agent_id || 'codex'"
          },
          "protocol_run_id": {
            "type": "javascript",
            "expr": "flow_input.protocol_run_id || 0"
          },
          "context": {
            "type": "javascript",
            "expr": "flow_input.context || {}"
          }
        }
      },
      {
        "id": "run_qa",
        "value": {
          "type": "script",
          "path": "u/devgodzilla/run_qa"
        },
        "input_transforms": {
          "step_id": {
            "type": "javascript",
            "expr": "flow_input.step_id"
          },
          "step_output": {
            "type": "javascript",
            "expr": "results.execute_step"
          },
          "constitution": {
            "type": "static",
            "value": {}
          }
        }
      }
    ]
  },
    "schema": {
        "type": "object",
        "$schema": "https://json-schema.org/draft/2020-12/schema",
    "properties": {
      "step_id": {
        "type": "string",
        "description": "Task step ID (e.g., T001)",
        "default": "T001"
      },
      "project_id": {
        "type": "integer",
        "description": "Optional TasksGodzilla project_id to associate with the emitted run",
        "default": 0
      },
      "agent_id": {
        "type": "string",
        "description": "AI agent to use (codex, claude-code, opencode)",
        "default": "codex"
      },
      "protocol_run_id": {
        "type": "integer",
        "description": "Protocol run ID for context",
        "default": 0
      },
      "context": {
        "type": "object",
        "description": "Additional context for execution",
        "default": {}
      },
      "tgz_run_id": {
        "type": "string",
        "description": "Optional TasksGodzilla codex run_id to update instead of using WM_JOB_ID",
        "default": ""
      },
      "tgz_params": {
        "type": "object",
        "description": "Optional params to store in TasksGodzilla codex run record",
        "default": {}
      },
      "tgz_attach_default_artifacts": {
        "type": "boolean",
        "description": "Whether to upsert windmill.{logs,result,error} artifacts in TasksGodzilla",
        "default": true
      }
    },
    "required": [
      "step_id"
    ]
  }
}
